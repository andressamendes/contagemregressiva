<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stranger Things: Milena ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@900&family=Courier+Prime:wght@400;700&family=Yellowtail&display=block" rel="stylesheet">
    <style>
        :root {
            --st-primary: #ff1e1e;
            --st-secondary: #8b0000;
            --st-text: #d1d5db;
            --st-bg-dark: #050505;
            --st-panel: rgba(10, 10, 10, 0.7);
            --st-panel-border: rgba(255, 30, 30, 0.4);
            --st-glow: 0 0 10px rgba(255, 30, 30, 0.8);
            --font-display: 'Merriweather', serif;
        }

        body {
            font-family: 'Courier Prime', monospace;
            overflow: hidden;
            background-color: var(--st-bg-dark);
            height: 100dvh;
            width: 100vw;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            color: var(--st-text);
            transition: color 1s ease;
        }

        .upside-down-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, #1a0b0b 0%, #080000 60%, #000000 100%);
            background-size: 150% 150%;
            z-index: -2;
            transition: opacity 1s ease;
        }
        
        .fog-layer {
            position: absolute; top: 0; left: 0; width: 200%; height: 100%;
            background: linear-gradient(90deg, transparent 0%, rgba(20, 0, 0, 0.2) 25%, transparent 50%, rgba(30, 0, 0, 0.2) 75%, transparent 100%);
            z-index: -1;
            opacity: 0.6;
            animation: driftFog 40s linear infinite;
            pointer-events: none;
        }

        @keyframes driftFog { from { transform: translateX(0); } to { transform: translateX(-50%); } }
        
        .lightning-flash {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 0, 0, 0.15);
            opacity: 0;
            z-index: -1;
            animation: flash 10s infinite random;
        }
        
        @keyframes flash {
            0%, 90%, 100% { opacity: 0; }
            92% { opacity: 0.6; }
            93% { opacity: 0; }
            94% { opacity: 0.4; }
            96% { opacity: 0; }
        }

        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.3));
            background-size: 100% 4px;
            z-index: 50; pointer-events: none; opacity: 0.6;
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.9) 100%);
            z-index: 51; pointer-events: none;
        }

        .spore {
            position: absolute; width: 3px; height: 3px;
            background: rgba(200, 200, 200, 0.5);
            border-radius: 50%; pointer-events: none;
            box-shadow: 0 0 4px rgba(255, 255, 255, 0.3);
            animation: floatSpore 12s infinite linear;
        }
        @keyframes floatSpore {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 0; }
            100% { transform: translate(var(--mx), var(--my)); opacity: 0; }
        }

        .st-title-container {
            position: relative;
            transform: scale(0.9);
            animation: zoomSlow 20s infinite alternate;
            cursor: pointer;
        }
        @keyframes zoomSlow { from { transform: scale(0.9); } to { transform: scale(1.0); } }

        .st-font { 
            font-family: var(--font-display); 
            font-weight: 900;
            text-transform: uppercase;
            -webkit-text-stroke: 1.5px var(--st-primary); 
            color: transparent;
            text-shadow: 0 0 8px rgba(255, 30, 30, 0.6);
            letter-spacing: -2px;
            line-height: 0.9;
            transition: all 0.5s;
        }
        
        .st-font-filled {
            font-family: var(--font-display); 
            font-weight: 900;
            color: var(--st-primary);
            text-transform: uppercase;
            text-shadow: 0 0 15px var(--st-primary);
            letter-spacing: -1px;
            transition: all 0.5s;
        }
        
        .st-title-container:active .st-font {
            text-shadow: 0 0 20px rgba(255, 30, 30, 1);
            filter: brightness(1.5);
        }
        
        .st-bar {
            height: 3px; background-color: var(--st-primary);
            box-shadow: 0 0 10px var(--st-primary);
            margin: 10px auto;
            width: 0;
            animation: expandBar 3s ease-out forwards 0.5s;
        }
        @keyframes expandBar { to { width: 60%; } }

        .glass-panel {
            background: var(--st-panel);
            border: 1px solid var(--st-panel-border);
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            border-radius: 16px;
            backdrop-filter: blur(8px);
            transition: all 0.5s ease;
        }

        .timer-val { font-weight: 700; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5); font-family: var(--font-display); transition: color 0.5s; }
        
        .timer-label { color: var(--st-primary); font-size: 0.6rem; letter-spacing: 2px; text-transform: uppercase; font-weight: bold; transition: color 0.5s; }

        .lights-container {
            position: absolute; top: -10px; width: 100%; display: flex; justify-content: space-around; z-index: 5;
            pointer-events: none;
        }
        .light-bulb {
            width: 14px; height: 22px; border-radius: 50%;
            opacity: 0.3; transition: opacity 0.1s, box-shadow 0.1s;
            position: relative;
        }
        .light-bulb::before {
            content: ''; position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 2px; height: 10px; background: #222;
        }
        
        .l-active { opacity: 1 !important; box-shadow: 0 0 20px currentColor; transform: scale(1.2); }
        
        .l-0 { background: #ef4444; color: #ef4444; }
        .l-1 { background: #3b82f6; color: #3b82f6; }
        .l-2 { background: #eab308; color: #eab308; }
        .l-3 { background: #22c55e; color: #22c55e; }
        .l-4 { background: #a855f7; color: #a855f7; }
        .l-5 { background: #f97316; color: #f97316; }

        #demogorgon-egg {
            position: fixed; bottom: -150px; right: -50px;
            width: 120px; height: 120px;
            z-index: 90; pointer-events: none;
            transition: bottom 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .demo-peek { bottom: 0 !important; }

        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 999;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 1s ease;
        }
        .overlay-disabled { pointer-events: none; opacity: 0.8; }

        .btn-interact {
            background: rgba(0,0,0,0.3); border: 1px solid var(--st-primary); color: var(--st-primary);
            transition: all 0.3s;
        }

        .envelope-btn, .quiz-btn, .ranking-btn, .challenge-btn {
            position: absolute;
            background: var(--st-bg-dark); border: 1px solid var(--st-primary); color: var(--st-primary);
            border-radius: 50%; width: 3.5rem; height: 3.5rem;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.2);
            z-index: 60; transition: all 0.3s;
            text-decoration: none;
        }

        .envelope-btn {
            bottom: 1.5rem;
            right: 1.5rem;
        }

        .quiz-btn {
            bottom: 1.5rem;
            left: 1.5rem;
        }

        .ranking-btn {
            top: 1.5rem;
            right: 1.5rem;
        }

        .challenge-btn {
            top: 1.5rem;
            left: 1.5rem;
        }

        .envelope-btn:hover, .quiz-btn:hover, .ranking-btn:hover, .challenge-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(255, 0, 0, 0.6);
        }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
        }
        .modal-active { opacity: 1; pointer-events: auto; }
        
        .letter-paper {
            background: #e3e3dc; width: 90%; max-width: 480px; padding: 2rem;
            transform: translateY(20px) scale(0.95); transition: transform 0.5s;
            color: #111; font-weight: bold; border: 2px solid #333;
            background-image: repeating-linear-gradient(#e3e3dc 0px, #e3e3dc 24px, #ccc 25px);
            line-height: 25px;
        }
        .modal-active .letter-paper { transform: translateY(0) scale(1); }
        
        #spell-text {
            position: absolute; top: 30px; width: 100%; text-align: center;
            font-family: 'Courier Prime', monospace; font-weight: bold; 
            font-size: 1.5rem; color: #fff; text-shadow: 0 0 10px #fff;
            opacity: 0; transition: opacity 0.2s;
        }

        @keyframes glitch-anim-1 {
            0% { clip-path: inset(20% 0 80% 0); transform: translate(-2px, 1px); }
            20% { clip-path: inset(60% 0 10% 0); transform: translate(2px, -1px); }
            40% { clip-path: inset(40% 0 50% 0); transform: translate(-2px, 2px); }
            60% { clip-path: inset(80% 0 5% 0); transform: translate(2px, -2px); }
            80% { clip-path: inset(10% 0 70% 0); transform: translate(-1px, 1px); }
            100% { clip-path: inset(30% 0 20% 0); transform: translate(1px, -1px); }
        }
        
        .glitch-active {
            animation: glitch-anim-1 0.2s infinite linear alternate-reverse;
            filter: hue-rotate(90deg) contrast(1.2);
        }

        .frenetic-lights .light-bulb {
            animation-duration: 0.1s !important;
            opacity: 1 !important;
        }

        @media (max-width: 380px) {
            .st-font { font-size: 2.5rem; }
            .timer-val { font-size: 2rem !important; }
        }
        
        #youtube-player { position: fixed; opacity: 0; pointer-events: none; }
        
        .element-float {
            position: absolute; color: var(--st-primary); text-shadow: 0 0 10px var(--st-primary);
            animation: floatUp 2s linear forwards; pointer-events: none; z-index: 100;
        }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0) scale(0.5); } 100% { opacity: 0; transform: translateY(-100px) scale(1.2); } }

        #chapter-text {
            transition: opacity 0.5s ease;
        }
    </style>
</head>
<body>

    <div class="scanlines"></div>
    <div class="vignette"></div>
    
    <div class="upside-down-bg"></div>
    <div class="fog-layer"></div>
    <div class="lightning-flash"></div>
    
    <div class="lights-container" id="lights-container">
        <div class="light-bulb l-0"></div>
        <div class="light-bulb l-1"></div>
        <div class="light-bulb l-2"></div>
        <div class="light-bulb l-3"></div>
        <div class="light-bulb l-4"></div>
        <div class="light-bulb l-5"></div>
    </div>
    <div id="spell-text"></div>

    <div id="spores-container" class="absolute inset-0 overflow-hidden pointer-events-none z-0"></div>
    
    <audio id="bg-music" loop preload="auto">
        <source src="https://stream.nightride.fm/nightride.m4a" type="audio/mp4">
        <source src="https://ice6.securenetsystems.net/RO80S" type="audio/mpeg">
    </audio>

    <div id="demogorgon-egg">
        <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g class="demo-head animate-bounce">
                <path d="M50 20 L60 5 L70 20 Z" fill="#881337" />
                <path d="M75 35 L95 30 L80 45 Z" fill="#881337" />
                <path d="M75 65 L95 70 L80 55 Z" fill="#881337" />
                <path d="M50 80 L60 95 L70 80 Z" fill="#881337" />
                <path d="M25 65 L5 70 L20 55 Z" fill="#881337" />
                <path d="M25 35 L5 30 L20 45 Z" fill="#881337" />
                <circle cx="50" cy="50" r="25" fill="#4c0519" />
                <circle cx="40" cy="45" r="2" fill="white" />
                <circle cx="60" cy="45" r="2" fill="white" />
                <path d="M40 60 Q50 70 60 60" stroke="white" stroke-width="2" stroke-linecap="round" />
            </g>
        </svg>
    </div>

    <!-- TELA INICIAL -->
    <div id="start-overlay" class="overlay-disabled">
        <div class="flex flex-col items-center justify-center h-full w-full cursor-pointer z-50 p-6" onclick="startExperience()">
            
            <div class="st-title-container mb-12 text-center" onclick="triggerWaffles(event)">
                <h1 class="st-font text-6xl md:text-8xl leading-none">PARA<br>MILENA</h1>
                <div class="st-bar"></div>
                <p id="chapter-text" class="text-white font-bold tracking-[0.5em] text-xs uppercase mt-2 opacity-80 h-4">Cap√≠tulo Um: O In√≠cio</p>
            </div>

            <div class="flex flex-col items-center gap-4 mt-8">
                <p id="start-text" class="text-red-600 font-bold tracking-[0.2em] text-xs uppercase animate-pulse">Sintonizando R√°dio...</p>
                <div id="start-icon" class="w-8 h-8 border-2 border-red-900 border-t-red-500 rounded-full animate-spin"></div>
            </div>
        </div>
    </div>

    <!-- CONTE√öDO PRINCIPAL -->
    <div id="main-content" class="relative z-10 w-full h-full flex flex-col items-center justify-center p-4 opacity-0 transition-opacity duration-1000 hidden">
        
        <div class="glass-panel w-full max-w-md p-6 text-center relative flex flex-col items-center max-h-[92dvh] overflow-y-auto custom-scrollbar">
            
            <h3 id="greeting-text" class="st-font-filled text-2xl mb-4 mt-2">Transmiss√£o Recebida</h3>
            
            <p id="timer-label" class="text-[10px] tracking-[0.25em] uppercase text-gray-400 mb-8 font-bold">Tempo para abertura do portal</p>
            
            <div class="w-full mb-8 border-b border-gray-500/30 pb-6">
                <div class="flex justify-center items-start gap-2 w-full text-white">
                    <div class="flex flex-col items-center w-1/4">
                        <span id="days" class="timer-val text-4xl md:text-5xl">00</span>
                        <span class="timer-label">Dias</span>
                    </div>
                    <span class="text-2xl text-red-600 mt-1 timer-sep">:</span>
                    <div class="flex flex-col items-center w-1/4">
                        <span id="hours" class="timer-val text-4xl md:text-5xl">00</span>
                        <span class="timer-label">Horas</span>
                    </div>
                    <span class="text-2xl text-red-600 mt-1 timer-sep">:</span>
                    <div class="flex flex-col items-center w-1/4">
                        <span id="minutes" class="timer-val text-4xl md:text-5xl">00</span>
                        <span class="timer-label">Min</span>
                    </div>
                    <span class="text-2xl text-red-600 mt-1 timer-sep">:</span>
                    <div class="flex flex-col items-center w-1/4">
                        <span id="seconds" class="timer-val text-4xl md:text-5xl w-[1.5em]">00</span>
                        <span class="timer-label">Seg</span>
                    </div>
                </div>
            </div>

            <div id="small-timer-box" class="mb-8 w-full bg-black/40 rounded p-4 border-l-4 border-red-600 transition-colors">
                <p class="text-[9px] tracking-[0.2em] uppercase text-gray-400 mb-2 font-bold">TEMPO DESDE O PRIMEIRO CONTATO</p>
                <div class="flex items-center justify-center gap-2">
                    <p id="past-time" class="text-white text-md sm:text-lg font-bold font-mono">Calculando...</p>
                </div>
            </div>

            <div class="min-h-[3rem] flex items-center justify-center mb-6 px-1">
                <h2 id="typewriter-text" class="text-xl font-bold text-center tracking-wider text-white"></h2>
            </div>

            <div class="flex flex-col gap-3 w-full items-center pb-2">
                <button onclick="showLoveReason(event)" class="btn-interact px-6 py-3 rounded text-xs font-bold tracking-[0.2em] uppercase w-full max-w-xs">
                    Decodificar Mensagem
                </button>
            </div>
            
            <p id="love-reason" class="min-h-[1.5rem] mt-3 text-white font-bold text-sm transition-all duration-500 opacity-0 transform translate-y-2 px-2"></p>

            <div class="h-8"></div>
        </div>
    </div>

    <!-- Bot√£o Ranking -->
    <a href="ranking.html" class="ranking-btn hidden" id="ranking-trigger" aria-label="Ver Ranking">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
        </svg>
    </a>

    <!-- Bot√£o Desafio 15 Dias -->
    <a href="challenge.html" class="challenge-btn hidden" id="challenge-trigger" aria-label="Desafio 15 Dias">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
    </a>

    <!-- Bot√£o Quiz -->
    <a href="quiz.html" class="quiz-btn hidden" id="quiz-trigger" aria-label="Jogar Quiz">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
    </a>

    <!-- Bot√£o Carta -->
    <button onclick="toggleLetter()" class="envelope-btn hidden" id="envelope-trigger" aria-label="Abrir carta">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </button>

    <!-- Modal da Carta -->
    <div id="letter-modal" class="modal-overlay" onclick="toggleLetter()">
        <div class="letter-paper" onclick="event.stopPropagation()">
            <div class="absolute top-2 right-2 p-2 opacity-50 cursor-pointer text-black" onclick="toggleLetter()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </div>
            <h3 class="st-font-filled text-xl mb-4 text-center">CONFIDENCIAL - PARA MILENA</h3>
            <div class="letter-content text-sm md:text-base">
                <p>Escrevo isso enquanto conto os segundos para te ver. Cada momento longe parece uma eternidade, mas saber que logo estarei com voc√™ faz tudo valer a pena.</p>
                <p class="mt-4">Mal posso esperar pelo nosso dia 26. Meu cora√ß√£o √© todo seu e a ansiedade s√≥ aumenta para o nosso reencontro. Te amo!</p>
            </div>
            <div class="flex justify-end items-end mt-8 border-t border-gray-500 pt-2">
                <p class="text-right font-bold text-lg mr-2 mb-0" style="font-family: 'Courier Prime', monospace;">- Com amor, Andressa</p>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ïES
        const targetDate = new Date("2026-01-26T20:00:00").getTime();
        const firstKissDate = new Date("2025-09-07T23:00:00").getTime();
        const mainPhrase = "Eu iria at√© o Mundo Invertido por voc√™";
        
        const reasons = [
            "Amigos n√£o mentem, e meu amor tamb√©m n√£o.",
            "Voc√™ √© meu 11 em uma escala de 10.",
            "Por voc√™, eu enfrentaria o Vecna.",
            "Promessa √© algo que n√£o se pode quebrar.",
            "Voc√™ faz minha vida virar de cabe√ßa para baixo (do jeito bom).",
            "Juntas, somos mais fortes que qualquer monstro.",
            "Voc√™ √© a luz na minha parede.",
            "A vida sem voc√™ √© como um waffle sem maple syrup."
        ];

        let player;
        let isPlayerReady = false;

        document.fonts.ready.then(() => {
            const startContent = document.getElementById('start-content');
            if(startContent) { startContent.classList.add('fonts-loaded-active'); }
        });

        const audio = document.getElementById('bg-music');
        
        audio.oncanplay = function() {
            if(!isPlayerReady) {
                isPlayerReady = true;
                updateStartScreenReady();
            }
        };
        
        setTimeout(() => { if(!isPlayerReady) { isPlayerReady = true; updateStartScreenReady(); } }, 3000);

        function updateStartScreenReady() {
            const textEl = document.getElementById('start-text');
            const iconEl = document.getElementById('start-icon');
            const overlay = document.getElementById('start-overlay');
            if(textEl) { 
                textEl.innerText = "TOQUE"; 
                textEl.classList.remove('animate-pulse'); textEl.classList.add('animate-bounce'); 
            }
            if(iconEl) { 
                iconEl.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>'; 
                iconEl.classList.remove('animate-spin'); 
                iconEl.className = "w-12 h-12 rounded-full bg-red-900/40 text-red-500 flex items-center justify-center border border-red-500 shadow-[0_0_15px_red]";
            }
            if(overlay) { overlay.classList.remove('overlay-disabled'); }
        }

        function triggerWaffles(e) {
            e.stopPropagation();
            for(let i=0; i<15; i++) {
                setTimeout(() => {
                    const x = Math.random() * window.innerWidth;
                    createWaffleAt(x, -50);
                }, i * 150);
            }
        }

        function createWaffleAt(x, y) {
            const el = document.createElement('div');
            el.innerHTML = 'üßá';
            el.style.position = 'fixed';
            el.style.left = x + 'px'; el.style.top = y + 'px';
            el.style.fontSize = (Math.random() * 1.5 + 1.5) + 'rem';
            el.style.pointerEvents = 'none'; el.style.zIndex = '100';
            el.style.animation = `fall ${Math.random() * 2 + 2}s linear forwards`;
            
            if (!document.getElementById('fall-style')) {
                const style = document.createElement('style');
                style.id = 'fall-style';
                style.innerHTML = `@keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }`;
                document.head.appendChild(style);
            }
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 4000);
        }

        const chapters = ["Cap√≠tulo Um: O In√≠cio", "Cap√≠tulo Dois: A Saudade", "Cap√≠tulo Tr√™s: O Reencontro"];
        let currentChapter = 0;
        
        function rotateChapters() {
            const el = document.getElementById('chapter-text');
            if(!el) return;
            
            setInterval(() => {
                el.style.opacity = '0';
                setTimeout(() => {
                    currentChapter = (currentChapter + 1) % chapters.length;
                    el.innerText = chapters[currentChapter];
                    el.style.opacity = '0.8';
                }, 500);
            }, 4000);
        }
        rotateChapters();

        document.addEventListener('click', (e) => {
            if(e.target.closest('button')) return;
            if(!e.target.closest('.st-title-container')) {
                createHeartAt(e.clientX, e.clientY);
            }
        });

        function createHeartAt(x, y) {
            const el = document.createElement('div');
            el.innerHTML = '‚ù§Ô∏è';
            el.className = 'element-float';
            el.style.left = x + 'px'; el.style.top = y + 'px';
            el.style.fontSize = (Math.random() * 1.5 + 1) + 'rem';
            el.style.filter = "drop-shadow(0 0 5px red)";
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1500);
        }

        const lights = document.querySelectorAll('.light-bulb');
        const milenaSeq = [0, 1, 2, 4, 3, 5];
        const letters = ['M', 'I', 'L', 'E', 'N', 'A'];
        let spelling = false;

        function startSpellingSequence() {
            if(spelling) return;
            spelling = true;
            let i = 0;
            lights.forEach(l => l.style.animation = 'none');
            const interval = setInterval(() => {
                lights.forEach(l => l.classList.remove('l-active'));
                if(i < milenaSeq.length) {
                    const idx = milenaSeq[i];
                    lights[idx].classList.add('l-active');
                    const textDisplay = document.getElementById('spell-text');
                    textDisplay.innerText = letters[i];
                    textDisplay.style.opacity = 1;
                    i++;
                } else {
                    clearInterval(interval);
                    document.getElementById('spell-text').style.opacity = 0;
                    setTimeout(() => {
                        lights.forEach(l => {
                            l.classList.remove('l-active');
                            l.style.animation = 'glow 1.5s infinite alternate';
                        });
                        spelling = false;
                    }, 1000);
                }
            }, 800);
        }
        setInterval(startSpellingSequence, 15000);

        function startExperience() {
            if(!isPlayerReady) return;
            
            audio.volume = 0;
            audio.play().then(() => {
                let vol = 0;
                const fade = setInterval(() => {
                    vol += 0.05;
                    if (vol >= 1) { 
                        vol = 1;
                        clearInterval(fade);
                    }
                    audio.volume = vol; 
                }, 200);
            }).catch(e => console.log("Audio play failed", e));

            setGreeting();
            const overlay = document.getElementById('start-overlay');
            const content = document.getElementById('main-content');
            const fab = document.getElementById('envelope-trigger');
            const quizBtn = document.getElementById('quiz-trigger');
            const rankingBtn = document.getElementById('ranking-trigger');
            const challengeBtn = document.getElementById('challenge-trigger');
            
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                content.classList.remove('hidden');
                fab.classList.remove('hidden');
                quizBtn.classList.remove('hidden');
                rankingBtn.classList.remove('hidden');
                challengeBtn.classList.remove('hidden');
                void content.offsetWidth;
                content.classList.remove('opacity-0');
            }, 600);

            setInterval(updateTimers, 1000);
            updateTimers();
            startSpores();
            setTimeout(typeWriter, 1000);
        }

        function setGreeting() {
            const h = new Date().getHours();
            const el = document.getElementById('greeting-text');
            const greet = h < 12 ? "OL√Å" : h < 18 ? "OL√Å" : "OL√Å";
            el.innerText = `${greet}, AMOR`;
        }

        function updateTimers() {
            const now = new Date().getTime();
            const distance = targetDate - now;
            const pastDiff = now - firstKissDate;

            if (pastDiff > 0) {
                const pd = Math.floor(pastDiff / (1000 * 60 * 60 * 24));
                const ph = Math.floor((pastDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const pm = Math.floor((pastDiff % (1000 * 60 * 60)) / (1000 * 60));
                const ps = Math.floor((pastDiff % (1000 * 60)) / 1000);
                
                if (distance >= 0) {
                    document.getElementById('past-time').innerText = `${pd}d ${ph}h ${pm}m ${ps}s`;
                }
            }

            if (distance < 0) {
                const pd = Math.floor(pastDiff / (1000 * 60 * 60 * 24));
                const ph = Math.floor((pastDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const pm = Math.floor((pastDiff % (1000 * 60 * 60)) / (1000 * 60));
                const ps = Math.floor((pastDiff % (1000 * 60)) / 1000);

                document.getElementById('days').innerText = String(pd).padStart(2, '0');
                document.getElementById('hours').innerText = String(ph).padStart(2, '0');
                document.getElementById('minutes').innerText = String(pm).padStart(2, '0');
                document.getElementById('seconds').innerText = String(ps).padStart(2, '0');
                document.getElementById('timer-label').innerText = "NOSSA HIST√ìRIA CONTINUA...";
                document.getElementById('past-time').innerText = "Desde o in√≠cio...";
            } else {
                const d = Math.floor(distance / (1000 * 60 * 60 * 24));
                const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((distance % (1000 * 60)) / 1000);
                
                document.getElementById('days').innerText = String(d).padStart(2, '0');
                document.getElementById('hours').innerText = String(h).padStart(2, '0');
                document.getElementById('minutes').innerText = String(m).padStart(2, '0');
                document.getElementById('seconds').innerText = String(s).padStart(2, '0');
            }
        }

        let typeIdx = 0;
        function typeWriter() {
            if (typeIdx < mainPhrase.length) {
                document.getElementById("typewriter-text").innerHTML += mainPhrase.charAt(typeIdx);
                typeIdx++; setTimeout(typeWriter, 100);
            } else {
                document.getElementById("typewriter-text").classList.remove("typing-effect");
            }
        }

        function toggleLetter() { 
            document.getElementById('letter-modal').classList.toggle('modal-active'); 
        }

        function showLoveReason(e) {
            e.stopPropagation();
            const el = document.getElementById('love-reason');
            el.classList.remove('opacity-100', 'translate-y-0');
            el.classList.add('opacity-0', 'translate-y-2');
            
            const mainContent = document.getElementById('main-content');
            const lightsContainer = document.getElementById('lights-container');
            
            mainContent.classList.add('glitch-active');
            lightsContainer.classList.add('frenetic-lights');
            
            setTimeout(() => {
                mainContent.classList.remove('glitch-active');
                lightsContainer.classList.remove('frenetic-lights');
            }, 800);
            
            setTimeout(() => {
                el.innerText = reasons[Math.floor(Math.random() * reasons.length)];
                el.classList.remove('opacity-0', 'translate-y-2');
                el.classList.add('opacity-100', 'translate-y-0');
                
                const burst = document.createElement('div');
                burst.style.position = 'fixed';
                burst.style.top = '0'; burst.style.left = '0'; burst.style.width = '100%'; burst.style.height = '100%';
                burst.style.background = 'rgba(255,0,0,0.1)';
                burst.style.pointerEvents = 'none';
                burst.style.transition = 'opacity 0.5s';
                document.body.appendChild(burst);
                setTimeout(() => burst.style.opacity = '0', 100);
                setTimeout(() => burst.remove(), 600);
            }, 300);
        }

        function startSpores() {
            const container = document.getElementById('spores-container');
            for(let i=0; i<40; i++) {
                const p = document.createElement('div');
                p.classList.add('spore');
                p.style.left = Math.random() * 100 + '%'; p.style.top = Math.random() * 100 + '%';
                const mx = (Math.random() * 40 - 20) + 'px'; const my = (Math.random() * 40 - 20) + 'px';
                p.style.setProperty('--mx', mx); p.style.setProperty('--my', my);
                p.style.animationDelay = (Math.random() * 5) + 's';
                p.style.animationDuration = (Math.random() * 10 + 8) + 's';
                container.appendChild(p);
            }
        }
    </script>
</body>
</html>
